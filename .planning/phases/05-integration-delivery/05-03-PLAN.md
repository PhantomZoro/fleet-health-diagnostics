---
phase: 05-integration-delivery
plan: 03
type: execute
wave: 2
depends_on:
  - "05-01"
  - "05-02"
files_modified:
  - backend/src/**/*.ts
  - frontend/src/**/*.ts
  - frontend/src/**/*.scss
autonomous: true
requirements:
  - DOC-01
  - DOC-02
  - DOC-03
  - DOC-04
must_haves:
  truths:
    - "Backend compiles with zero errors and zero warnings"
    - "Frontend builds with ng build --configuration production with zero errors"
    - "No console.log statements remain in production code (except bootstrap error handler)"
    - "No TODO or FIXME comments remain in source files"
    - "docker-compose up from clean state starts both services and app is accessible"
  artifacts:
    - path: "backend/src/**/*.ts"
      provides: "Clean production-ready backend source"
    - path: "frontend/src/**/*.ts"
      provides: "Clean production-ready frontend source"
  key_links:
    - from: "docker-compose.yml"
      to: "localhost:4200"
      via: "container startup and nginx serving"
      pattern: "4200"
---

<objective>
End-to-end smoke test and code cleanup — verify the full application works, remove debug artifacts, ensure code is clean and production-ready.

Purpose: Final quality gate before submission. Ensure no debug code, TODO comments, or formatting issues survive to the reviewer's eyes.

Output: Clean, verified codebase ready for BMW reviewer submission.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-integration-delivery/05-01-SUMMARY.md
@.planning/phases/05-integration-delivery/05-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Code cleanup — remove debug artifacts and verify builds</name>
  <files>backend/src/**/*.ts, frontend/src/**/*.ts</files>
  <action>
**Step 1 — Find and remove debug code:**

Search across ALL source files for:
- `console.log` — remove from all files EXCEPT the bootstrap catch handler in `backend/src/index.ts` (`bootstrap().catch(console.error)`) and legitimate server startup messages (`console.log('Database connected')`, `console.log('Server running...')`). Remove any debug/development console.log statements.
- `// TODO` or `// FIXME` or `// HACK` comments — remove or resolve every one
- `debugger` statements — remove all
- Commented-out code blocks (more than 2 lines) — remove all

**Step 2 — Verify backend build:**
```bash
cd backend && npx tsc --noEmit
```
Must produce zero errors. Fix any TypeScript errors found.

**Step 3 — Verify frontend build:**
```bash
cd frontend && npx ng build --configuration production
```
Must produce zero errors and zero warnings. Fix any issues found.

**Step 4 — Verify code consistency:**
- Check that all imports are used (no unused imports)
- Check that no `any` types have crept in (TypeScript strict mode)
- Verify consistent use of single quotes vs double quotes (match existing pattern)

Do NOT run Prettier or ESLint reformatting — the project doesn't have these configured, and adding formatting changes would pollute the git diff. Only fix actual issues.
  </action>
  <verify>
- `cd backend && npx tsc --noEmit` exits with code 0
- `cd frontend && npx ng build --configuration production` exits with code 0
- `grep -r "console.log" backend/src/ --include="*.ts"` shows only legitimate startup messages
- `grep -r "TODO\|FIXME\|HACK" backend/src/ frontend/src/app/ --include="*.ts"` returns no results
- `grep -r "debugger" backend/src/ frontend/src/app/ --include="*.ts"` returns no results
  </verify>
  <done>Both backend and frontend compile cleanly. No debug console.logs, TODO comments, or commented-out code remain. TypeScript strict mode enforced with zero any types.</done>
</task>

<task type="auto">
  <name>Task 2: End-to-end smoke test and Docker verification</name>
  <files></files>
  <action>
**Step 1 — Manual dev mode smoke test:**

Start backend in dev mode:
```bash
cd backend && npm run dev &
```
Wait for "Server running on port 3000" message. Then verify:
- `curl http://localhost:3000/health` returns `{"status":"ok","events":N}` where N > 0
- `curl "http://localhost:3000/api/events?page=1&limit=5"` returns paginated response with data array
- `curl http://localhost:3000/api/aggregations/errors-per-vehicle` returns aggregation data
- `curl http://localhost:3000/api/aggregations/top-codes` returns top codes
- `curl http://localhost:3000/api/aggregations/critical-vehicles` returns critical vehicles array

Test edge cases:
- `curl "http://localhost:3000/api/events?level=INVALID"` returns 400
- `curl "http://localhost:3000/api/events?page=-1"` returns 400
- `curl http://localhost:3000/api/nonexistent` returns 404

Stop backend after verification.

**Step 2 — Verify docker-compose configuration:**
```bash
docker-compose config
```
Must validate without errors. If Docker is not available in the environment, verify the docker-compose.yml syntax is valid by checking the YAML structure manually.

**Step 3 — Final documentation review:**
- Read README.md and verify all commands are correct
- Read docs/REQUIREMENTS.md and verify business requirements match actual features
- Read docs/ARCHITECTURE.md and verify technical descriptions match actual code
- Check for typos and broken markdown links

If any issues found in documentation, fix them.

**Step 4 — Verify git cleanliness:**
- Run `git status` to check for untracked files that should be gitignored
- Ensure `.dockerignore` covers node_modules, dist, .db files
- Ensure no secrets or credentials are in tracked files
  </action>
  <verify>
- Backend health endpoint returns 200 with event count
- All API endpoints return expected response shapes
- Invalid inputs return 400 status codes
- docker-compose.yml validates (or is structurally correct if Docker unavailable)
- README.md commands match actual project setup
- No untracked sensitive files in git
  </verify>
  <done>Full API smoke test passes with all endpoints returning correct data. Docker configuration validated. Documentation verified accurate. No sensitive files exposed. Application is ready for BMW reviewer submission.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` in backend — zero errors
2. `npx ng build --configuration production` in frontend — zero errors, zero warnings
3. No console.log (except startup), no TODO, no debugger in source
4. All API endpoints respond correctly (200 for valid, 400 for invalid, 404 for missing)
5. docker-compose.yml validates
6. All three documentation files are accurate to the codebase
7. git status shows no accidentally tracked secrets or build artifacts
</verification>

<success_criteria>
- Clean builds for both backend (tsc) and frontend (ng build)
- All API endpoints verified via curl
- Zero debug artifacts in production code
- Documentation matches reality
- Submission-ready state — a BMW reviewer can clone, run, and evaluate
</success_criteria>

<output>
After completion, create `.planning/phases/05-integration-delivery/05-03-SUMMARY.md`
</output>

---
phase: 04-frontend-views
plan: 02
type: execute
wave: 2
depends_on:
  - 04-01
files_modified:
  - frontend/src/app/features/events/events.component.ts
  - frontend/src/app/features/events/events.component.html
  - frontend/src/app/features/events/events.component.scss
autonomous: true
requirements:
  - VIEW-02
  - VIEW-05

must_haves:
  truths:
    - "Events table displays diagnostic events with Timestamp, Vehicle ID, Severity, Code, Message columns"
    - "Severity column renders colored badges via SeverityBadgeComponent"
    - "Pagination controls navigate between pages and update the table"
    - "Filter panel triggers debounced API calls via store.setFilters()"
    - "Loading spinner appears while fetching events"
    - "Empty state message shows when no events match filters"
  artifacts:
    - path: "frontend/src/app/features/events/events.component.ts"
      provides: "Smart EventsComponent injecting DiagnosticsStore"
      contains: "providers: [DiagnosticsStore]"
    - path: "frontend/src/app/features/events/events.component.html"
      provides: "Events table with filter panel, pagination, loading, empty state"
      contains: "<table"
    - path: "frontend/src/app/features/events/events.component.scss"
      provides: "Table styling with severity-aware layout"
  key_links:
    - from: "frontend/src/app/features/events/events.component.ts"
      to: "frontend/src/app/store/diagnostics.store.ts"
      via: "inject(DiagnosticsStore) + providers array"
      pattern: "providers:.*DiagnosticsStore"
    - from: "frontend/src/app/features/events/events.component.html"
      to: "frontend/src/app/shared/filter-panel/filter-panel.component.ts"
      via: "template <app-filter-panel>"
      pattern: "app-filter-panel"
    - from: "frontend/src/app/features/events/events.component.html"
      to: "frontend/src/app/shared/pagination/pagination.component.ts"
      via: "template <app-pagination>"
      pattern: "app-pagination"
---

<objective>
Build the Events view — a smart component at `/events` that displays a searchable, filterable, paginated table of diagnostic events with severity badges, loading indicator, and empty state.

Purpose: This is the primary data exploration view for operations engineers. It connects the FilterPanel/Pagination/SeverityBadge/LoadingSpinner shared components to DiagnosticsStore, demonstrating the smart/dumb component split and RxJS-driven state flow.

Output: A fully functional `EventsComponent` replacing the current stub at `frontend/src/app/features/events/`.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-frontend-views/04-01-SUMMARY.md
@frontend/src/app/store/diagnostics.store.ts
@frontend/src/app/store/diagnostics-state.model.ts
@frontend/src/app/core/models/index.ts
@frontend/src/styles.scss
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement EventsComponent as smart container with table, filters, pagination, and states</name>
  <files>
    frontend/src/app/features/events/events.component.ts
    frontend/src/app/features/events/events.component.html
    frontend/src/app/features/events/events.component.scss
  </files>
  <action>
    Replace the existing stub `EventsComponent` with a fully functional smart component.

    **Component file (`events.component.ts`):**
    - Standalone component, `ChangeDetectionStrategy.OnPush`
    - `providers: [DiagnosticsStore]` — component-level store instance (per Phase 3 pattern)
    - `imports: [CommonModule, FilterPanelComponent, SeverityBadgeComponent, PaginationComponent, LoadingSpinnerComponent]`
    - `templateUrl: './events.component.html'`, `styleUrl: './events.component.scss'`
    - Inject `DiagnosticsStore` via `inject(DiagnosticsStore)`
    - Expose observables for template: `events$ = this.store.events$`, `loading$ = this.store.loading$`, `total$ = this.store.total$`, `page$ = this.store.page$`, `filters$ = this.store.filters$`, `error$ = this.store.error$`
    - Also expose `limit` as a constant (20) or from store state for pagination
    - Methods:
      - `onFiltersApply(filters: EventFilters)`: calls `this.store.setFilters(filters)`
      - `onFiltersReset()`: calls `this.store.resetFilters()`
      - `onPageChange(page: number)`: calls `this.store.setPage(page)`
    - No manual subscriptions needed — use `async` pipe in template. The store's effects auto-trigger on state changes (wired in constructor).

    **Template file (`events.component.html`):**
    ```
    <section class="events-view">
      <h2>Diagnostic Events</h2>

      <app-filter-panel
        [filters]="(filters$ | async) ?? {}"
        (filtersApply)="onFiltersApply($event)"
        (filtersReset)="onFiltersReset()">
      </app-filter-panel>

      <div class="table-container">
        @if (loading$ | async) {
          <app-loading-spinner />
        }

        @if ((events$ | async); as events) {
          @if (events.length > 0) {
            <table>
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Vehicle ID</th>
                  <th>Severity</th>
                  <th>Code</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody>
                @for (event of events; track event.id) {
                  <tr>
                    <td>{{ event.timestamp | date:'short' }}</td>
                    <td>{{ event.vehicleId }}</td>
                    <td><app-severity-badge [level]="event.level" /></td>
                    <td><code>{{ event.code }}</code></td>
                    <td>{{ event.message }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            @if (!(loading$ | async)) {
              <div class="empty-state" role="status">
                <p>No events match your filters.</p>
                <p class="empty-hint">Try adjusting your search criteria or resetting filters.</p>
              </div>
            }
          }
        }
      </div>

      @if ((total$ | async); as total) {
        <app-pagination
          [total]="total"
          [page]="(page$ | async) ?? 1"
          [limit]="20"
          (pageChange)="onPageChange($event)">
        </app-pagination>
      }
    </section>
    ```

    Use Angular 19 `@if`/`@for` template syntax (not `*ngIf`/`*ngFor`). Import `DatePipe` from `@angular/common` in the component imports array for the `date` pipe.

    **Styles file (`events.component.scss`):**
    - `.events-view`: max-width 1200px, margin 0 auto, padding 24px
    - `h2`: font-size 20px, margin-bottom 16px, color var(--text-dark)
    - `.table-container`: position relative (for spinner overlay), min-height 200px, margin-top 16px, background var(--surface-card), border-radius var(--radius), overflow hidden
    - `table`: width 100%, border-collapse collapse
    - `thead th`: padding 10px 16px, text-align left, font-size 12px, text-transform uppercase, letter-spacing 0.5px, color var(--text-secondary), border-bottom 2px solid var(--border-light), background var(--surface-card)
    - `tbody td`: padding 10px 16px, border-bottom 1px solid var(--border-light), font-size 13px, vertical-align middle
    - `tbody tr:hover`: background-color rgba(28, 105, 212, 0.04)
    - `td code`: font-family monospace, font-size 12px, background rgba(0,0,0,0.04), padding 2px 6px, border-radius 3px
    - `.empty-state`: text-align center, padding 48px 24px, color var(--text-secondary)
    - `.empty-state p:first-child`: font-size 16px, font-weight 500
    - `.empty-hint`: font-size 13px, margin-top 8px
  </action>
  <verify>
    Run `cd frontend && npx ng build --configuration development 2>&1 | tail -5` — must compile with zero errors.
    Verify the following in events.component.ts:
    - `providers: [DiagnosticsStore]` exists
    - `ChangeDetectionStrategy.OnPush` is set
    - `inject(DiagnosticsStore)` is used (not constructor injection)
    Verify the following in events.component.html:
    - `<table>` element exists (semantic HTML)
    - `<app-filter-panel` exists
    - `<app-severity-badge` exists
    - `<app-pagination` exists
    - `<app-loading-spinner` exists
    - "No events match" empty state text exists
  </verify>
  <done>
    EventsComponent is a smart container that injects DiagnosticsStore, displays events in a semantic `<table>` with FilterPanel at top, SeverityBadge in severity column, Pagination at bottom, LoadingSpinner overlay while fetching, and "No events match your filters" empty state. All state flows through async pipe — no manual subscriptions. OnPush change detection. Angular build passes.
  </done>
</task>

</tasks>

<verification>
1. Navigate to `/events` — filter panel, table, and pagination render
2. Apply filters → store.setFilters triggers debounced API call → table updates
3. Severity column shows colored badges (red ERROR, orange WARN, blue INFO)
4. Click Next/Prev → pagination updates, new page loads
5. Apply filters that match nothing → "No events match your filters" empty state
6. Loading spinner appears between filter apply and data arrival
7. `ng build` passes with zero TypeScript errors
</verification>

<success_criteria>
- EventsComponent replaces stub with full table, filter, pagination, loading, empty state
- Smart/dumb split: EventsComponent injects store, shared components use @Input/@Output only
- All state via async pipe — no manual subscribe calls
- Semantic HTML: `<section>`, `<table>`, `<thead>`, `<tbody>`
- OnPush change detection on EventsComponent
- Angular build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/04-frontend-views/04-02-SUMMARY.md`
</output>
